version: 2

models:
  - name: ent_user
    description: |
      Current state view of all users with their profile attributes and aggregated order metrics.
      Combines user demographic data with behavioral metrics for a complete user profile.
      - Type: Entity-centric model (Normalized, 3NF-style)
      - Grain: One row per user
      - Sources: dim_user, agg_user_on_order
      - Refresh: Full refresh on each dbt run
    
    columns:
      - name: user_id
        description: '{{(doc("user_id"))}}'
        tests:
          - not_null
          - unique   
      - name: ip_country
        description: '{{(doc("ip_country"))}}'
      - name: platform
        description: '{{(doc("platform"))}}'
      - name: created_at
        description: '{{(doc("created_at"))}}'
        tests:
          - not_null      
      - name: updated_at
        description: '{{(doc("updated_at"))}}'
        tests:
          - not_null            
      - name: total_orders
        description: "Total number of orders placed by this user (lifetime)"            
      - name: first_purchase_on
        description: "Date of the user's first order (NULL if no orders)"           
      - name: last_purchase_on
        description: "Date of the user's most recent order (NULL if no orders)"           
      - name: days_between_first_and_last
        description: "Number of days between first and last purchase (NULL if 0 or 1 orders)"            
      - name: is_new_user
        description: "Boolean flag - True if user has made their first purchase within the last 30 days"            
      - name: is_returned_user
        description: "Boolean flag - True if user has made more than one purchase"            
      - name: is_churned_user
        description: "Boolean flag - True if user hasn't made a purchase in the last 90 days (but has historical orders)"