version: 2

snapshots:
  - name: snp_raw_user
    description: |
      **Type:** Slowly Changing Dimension Type 2 (SCD2) Snapshot
      
      Tracks historical changes in user attributes over time.
      
      **Strategy:** Check columns (ip_country, platform)
      **Unique Key:** user_id
      **Target Schema:** snapshots
      **Source:** raw.user
      
      **Tracked Changes:**
      - User migrating between countries (ip_country changes)
      - User switching platforms (platform changes)
      
      **Snapshot Behavior:**
      - New record created when ip_country OR platform changes
      - Previous record's dbt_valid_to is set to change timestamp
      - Current records have dbt_valid_to = NULL
      
      **Refresh:** Run via `dbt snapshot` command
    columns:
      - name: user_id
        description: "{{ doc('user_id') }} - Natural key for SCD tracking"
      - name: ip_country
        description: "{{ doc('ip_country') }} - **Tracked:** Changes trigger new snapshot"
      - name: platform
        description: "{{ doc('platform') }} - **Tracked:** Changes trigger new snapshot"
      - name: dbt_scd_id
        description: "{{ doc('dbt_scd_id') }}"
        tests:
          - not_null
          - unique
      - name: dbt_updated_at
        description: "{{ doc('dbt_updated_at') }}"
      - name: dbt_valid_from
        description: "{{ doc('dbt_valid_from') }}"
      - name: dbt_valid_to
        description: "{{ doc('dbt_valid_to') }}"

  - name: snp_raw_exchange_rate
    description: |
      **Type:** Slowly Changing Dimension Type 2 (SCD2) Snapshot
      
      Tracks historical changes in currency exchange rates.
      
      **Strategy:** Check columns (usd_rate, currency)
      **Unique Key:** currency
      **Target Schema:** snapshots
      **Source:** raw.exchange_rate
      
      **Tracked Changes:**
      - Exchange rate fluctuations (usd_rate changes)
      - Currency additions/modifications
      
      **Snapshot Behavior:**
      - New record created when usd_rate changes
      - Enables point-in-time currency conversions
      - Current rates have dbt_valid_to = NULL
      
      **Refresh:** Run via `dbt snapshot` command
    columns:
      - name: currency
        description: "{{ doc('currency') }} - Natural key for SCD tracking"
      - name: usd_rate
        description: "{{ doc('usd_rate') }} - **Tracked:** Changes trigger new snapshot"
      - name: dbt_scd_id
        description: "{{ doc('dbt_scd_id') }}"
        tests:
          - not_null
          - unique
      - name: dbt_updated_at
        description: "{{ doc('dbt_updated_at') }}"
      - name: dbt_valid_from
        description: "{{ doc('dbt_valid_from') }}"
      - name: dbt_valid_to
        description: "{{ doc('dbt_valid_to') }}"